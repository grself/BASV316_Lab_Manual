# (PART) Counting {-}

# Frequency Tables {#lab5}

```{r include = FALSE}

# Load some libraries
library(knitr)
library(kableExtra) # For building pretty tables
library(here)

# Set the rproj home directory
here::here()

# Set some knitr options
options(knitr.table.format = "html")
knitr::opts_chunk$set(
  collapse = TRUE,
  strip.white = TRUE,
  comment = "#>",
  out.width = "65%",
  message=FALSE,
  warnings=FALSE
)

# Turn on the DataCamp Light interactive tools
tutorial::go_interactive()

```


## Introduction

Categorical data items are normally reported in frequency tables and crosstabs where the counts for a particular item are displayed. The only difference between these two types of tables is in the number of dimensions they display, frequency tables display only a single variable while a crosstab displays two variables. Both of these types of tables are commonly used to display polling data during the run-up to an election and would list things like the number of voters who would support some proposition (frequency table) or that same data broken out by party affiliation, sex, age, or some other category (crosstab). This lab explores both types of table.

-----

## Frequency Tables

A frequency table is a one-dimensional table that lists a count of the number of times that some categorical data item appears in a vector. As an example, consider the following table which lists the number of cars for each number of cylinders in the [_mtcars_](/tutorials/9999-data-dict/index.html#mtcars) data frame.

```{r tut=FALSE}
table(mtcars$cyl)
```

This table shows that 11 cars in the data frame had 4 cylinders, 7 had 6 cylinders, and 14 had eight cylinders. 

Frequency tables are only useful for categorical data-type items. To illustrate why this is true, imagine creating a survey for all of the students at the University of Arizona and including "age" (continuous-type data) as one of the survey questions. Attempting to create a frequency table for the ages of the respondents would have, potentially, more than 65 columns since student ages would range from about 15 to more than 80 and each column would report the number of students for that particular age. While R could create a frequency table that large it would have so many columns that it would be virtually unusable. Normally, if continuous-type data need to be displayed in a table the data are grouped in some way, like ages 15-19, 20-24, etc, so there would be a manageable number of group counts to display.

### Demonstration: Frequency Tables

The following script creates a frequency table.

* Line 2: Create a simple frequency table listing the number of cars by the forward gears.

```{r tut=TRUE}

# Count of cars by gears
table(mtcars$gear)

```

### Skill Check: Frequency Tables

Using the [_chickwts_](/tutorials/9999-data-dict/index.html#chickwts) data frame, create a frequency table for _feed_.

```{r ex="ex01", type="pre-exercise-code"}

# No pre-exercise code for this exercise

```

```{r ex="ex01", type="sample-code"}

# Create a frequency table for feed in the chickwts data frame.


```

```{r ex="ex01", type="solution"}

table(chickwts$feed)

```

```{r ex="ex01", type="sct"}

ex1neq <- "Check that the variable for the table function is chickwts$feed."

ex() %>% 
  check_function("table") %>% 
  check_arg("...") %>% 
  check_equal(incorrect_msg = ex1neq)

success_msg("Good work! A frequency table is a foundational categorical data analysis tool!")

```

-----

## Margins

It is often useful to include the total number of items counted in a frequency table and that is provided by the `addmargins` function. As an example, consider the following table which is the same frequency table shown above but includes the total number of cars in the data frame.

```{r tut=FALSE}

addmargins(table(mtcars$cyl))

```


### Demonstration: Margins

The following script creates a frequency table with margins

* Line 2: Create a frequency table with margins listing the number of cars by the forward gears.

```{r tut=TRUE}

# Count of cars by gears
addmargins(table(mtcars$gear))

```


### Skill Check: Margins

Using the _chickwts_ data frame, create a frequency table with margins for _feed_.

```{r ex="ex02", type="pre-exercise-code"}

# No pre-exercise code for this exercise

```

```{r ex="ex02", type="sample-code"}

# Create a frequency table with margins for feed in the chickwts data frame.


```

```{r ex="ex02", type="solution"}

addmargins(table(chickwts$feed))

```

```{r ex="ex02", type="sct"}

ex21neq <- "Check that the addmargins function calls table(chickwts$feed)."

ex() %>%
  check_function("addmargins") %>%
  check_result() %>%
  check_equal(incorrect_msg = ex21neq)

success_msg("Perfect! Margins provide a little extra information to a frequency table!")

```

-----

## Proportion Tables (Proptables)

Occasionally, researchers prefer to present percentages rather than raw numbers since those are easier to quickly interpret. Here is a proportion table of the number of cylinders for cars in the _mtcars_ data frame.

```{r tut=FALSE}

prop.table(table(mtcars$cyl)) * 100

```

Thus, about 44% of the cars have eight cylinders.

### Demonstration: Proportion Tables (Proptables)

The following script creates a proportion table with the results presented in percent format and rounded to two places.

* Line 2: Create a simple proportion table listing the number of cars by the forward gears.
* Line 5: Multiply all values in the proportion table by 100 to make it a percentage.

<span style="background-color: #ffff99; font-style: italic;">This demonstration contains two different examples of generating a proportion table.</span>

```{r tut=TRUE}

# Proportion table
prop.table(table(mtcars$gear))

# Multiply all proportions by 100 to make them percentages
prop.table(table(mtcars$gear)) * 100

```

### Skill Check: Proportion Tables (Proptables)

Using the _chickwts_ data frame, create a proportion table for _feed_. The proportions should be multiplied by 100.

```{r ex="ex03", type="pre-exercise-code"}

# No pre-exercise code for this exercise

```

```{r ex="ex03", type="sample-code"}

# Create a proportion table for feed in the chickwts data frame.


```

```{r ex="ex03", type="solution"}

prop.table(table(chickwts$feed)) * 100

```

```{r ex="ex03", type="sct"}

ex31neq <- "Check that the prop.table function calls table(chickwts$feed)."
ex32neq <- "Check that the results of the prop.table function are multiplied by 100."

ex() %>%
  check_function("prop.table") %>%
  check_result() %>%
  check_equal(incorrect_msg = ex31neq)

ex() %>%
  check_code(".+[*]\\s*100", missing_msg = ex32neq)

success_msg("Perfect! A proportion table formatted like this is a valuable tool!")

```

-----

## Crosstabs

A crosstab (sometimes called a contingency table or pivot table), is a table of frequencies used to display the relationship between two nominal or ordinal variables. As an example of a crosstab, consider a table listing _mtcars_ by the number of forward gears and the number of cylinders.


```{r tut=FALSE}

xtabs(~gear+cyl, data=mtcars)

```

In this case, one car had a four cylinder engine and three forward gears while 12 cars had eight cylinders and three forward gears. By using a crosstab, a researcher can determine the frequency of some incident (number of cars) by two different criteria (gears and cylinders).

Here is a second example from the [_esoph_](/tutorials/9999-data-dict/index.html#esoph) data frame.

```{r tut=FALSE}

xtabs(~agegp+ncases, data=esoph)

```

Notice that there were few cases of esophageal cancer among people under the age of 45 but the number of cases increased between the ages of 45 and 74, with a peak in the 55-64 age group.

### Demonstration: Crosstabs

The following script demonstrates how to create crosstabs.

* Line 2: The `xtabs` command (for "Cross Tabs") creates a crosstab for the variables entered. It is important to notice the tilde character in this function. In many _R_ commands the tilde is used to separate two parts of a formula. The part before the tilde are the data values to be acted upon and the second part are the grouping vectors. In Line 2, there are no data values specified so _R_ will simply count the number of times the various groups show up. The "row" group is listed first and then the "column" group. For example, "gear 3 - cylinder 8" appear 12 times in the data frame.

```{r}

# Count of gears and cylinders
xtabs(~mtcars$gear+mtcars$cyl)

```

### Skill Check: Crosstabs

Using the _esoph_ data frame, create a crosstabs table for _tobgp_ (tobacco group) and _alcgp_ (alcohol group).

```{r ex="ex04", type="pre-exercise-code"}

# No pre-exercise code for this exercise

```

```{r ex="ex04", type="sample-code"}

# Create a crosstabs table for tobgp and alcgp in the esoph data frame.

```

```{r ex="ex04", type="solution"}

xtabs(~esoph$tobgp+esoph$alcgp)

```

```{r ex="ex04", type="sct"}

ex41neq <- "There should be a tilde followed by the two grouping variables."

ex() %>% 
  check_function("xtabs") %>% 
  check_arg("formula") %>% 
  check_equal(incorrect_msg = ex41neq)

success_msg("Perfect! This type of crosstab is very commonly used!")

```

-----

## Multi-Dimensional Crosstabs

Crosstabs can contain more than two dimensions. As an example, consider an experiment with pea plants where the amount of nitrogen, phosphorus, and potassium was varied to see what would happen to the crop yield. The [_npk_](/tutorials/9999-data-dict/index.html#npk) data frame contains the result of that experiment and this crosstab displays that result in a multidimensional table. Notice that the row group is listed first, the column group is second, and the block group is third.

```{r tut=FALSE}

xtabs(~N+P+K, data=npk)

```

When nitrogen (N) is 0, phosphorus (P) is 0, and potassium (K) is 0 the crop yield is 154.3 pounds/plot.

As a second example, consider the _mtcars_ data frame. A researcher wanted to know if there is any relationship between the number of forward gears, the number of cylinders in the engine (that is, the size of the engine), and whether the car had a manual or automatic transmission. Here is the crosstab that was created.

```{r tut=FALSE}

xtabs(~cyl+gear+am, data=mtcars)

```

When _am_ is 0 (which is the code for an automatic transmission) there were no cars with five forward gears and when _am_ is 1 (manual transmission) there were no cars with three forward gears.

### Demonstration: Multi-dimensional Crosstabs

The following script demonstrates how to create multi-dimensional crosstabs.

* Line 2: The `xtabs` command creates a crosstab for the variables entered. In this case, there is nothing on the left side of the tilde so _R_ will return a count of the various categories. Since there are three grouping variables, _gear_, _cyl_, and _am_, _R_ will count instances for all three variables. For example, "gear 4" and "cylinder 4" appear together 2 times when the transmission is 0 and 6 times when the transmission is 1. Note that a _data = mtcars_ parameter is also specified so the word _mtcars$_ does not need to be used for each variable. This makes the formula easier to read. 
* Line 5: This is just another example of multi-dimensional crosstab.

<span style="background-color: #ffff99; font-style: italic;">This demonstration contains two different examples of generating a multi-dimensional crosstab.</span>

```{r}

# Count of gears and cylinders by transmission
xtabs(~gear+cyl+am, data = mtcars)

# Count of carbs and cylinders by engine type
xtabs(~carb+cyl+vs, data = mtcars)

```


### Skill Check: Multi-dimensional Crosstabs

Using the _esoph_ data frame, create a crosstabs table for _tobgp_ (tobacco group), _alcgp_ (alcohol group), and _agegp_ (age group). To make the _R_ command easier to read, specify the data frame as a "data = esoph" instead of using the "esoph$..." format.

```{r ex="ex05", type="pre-exercise-code"}

# No pre-exercise code for this exercise

```

```{r ex="ex05", type="sample-code"}

# Create a crosstabs table for tobgp, alcgp, and agegp in the esoph data frame.

```

```{r ex="ex05", type="solution"}

xtabs(~tobgp+alcgp+agegp, data=esoph)

```

```{r ex="ex05", type="sct"}

ex51neq <- "There should be a tilde followed by the three grouping variables."
ex52neq <- "Be sure esoph is specified as the data."

funstate <- ex() %>% check_function("xtabs")
funstate %>% 
  check_arg("formula") %>% 
  check_equal(incorrect_msg = ex51neq)

funstate %>% 
  check_arg("data") %>% 
  check_equal(incorrect_msg = ex52neq)

success_msg("Perfect! A multi-dimensional crosstab is very useful!")

```

-----

## Calculated Crosstabs

Each of the crosstabs presented so far have displayed only counts of data; however, by using the `aggregate` function, crosstabs can also display calculated values, like the mean temperature for each summer month in the [_airquality_](/tutorials/9999-data-dict/index.html#airquality) data frame.

```{r agg02, tut=FALSE}

aggregate(Temp ~ Month, 
                data = airquality, 
                FUN = mean)

```

Though the above table has a number of calculated values the _R_ command is only one line long.

As another example, the mean horsepower for automobiles can be calculated by the number of forward gears and engine cylinders from the _mtcars_ data frame.

```{r agg01, tut=FALSE}

aggregate(hp ~ gear + cyl, 
          data = mtcars, 
          FUN = mean)

```

### Demonstration: Calculated Crosstab

The following script demonstrates how to create calculated crosstab.

* Line 2: This line uses the `aggregate` command to calculate the mean displacement for each category of cylinders. Notice that this command has a tilde formula where displacement will be aggregated for each category of cylinders. The values to be calculated comes first (displacement) and the grouping variable comes second (cylinder). Next is the name of the dataset used. Finally, the statistical function is listed as _FUN = mean_. Note that the key word _FUN_ is in capital letters. This aggregate function determines that four cylinder cars have a mean displacement of just over 105 cubic inches.
* Line 5: This line also calculates the mean displacement but groups the result by both number of cylinders and number of forward gears, creating a multi-dimensional calculated crosstab. It calculates that the mean displacement for four cylinder cars with three forward gears is just over 120 cubic inches.


```{r}

# Mean of displacement by cylinders
aggregate(disp~cyl, data = mtcars, FUN = mean)

# Mean of displacement by cyl and gears
aggregate(disp~cyl+gear, data = mtcars, FUN = mean)

```

### Skill Check: Calculated Crosstabs

Using the _npk_ data frame, create a calculated crosstab for _N_ (nitrogen), _P_ (phosphate), and _K_ (potassium). Aggregate the mean _yield_ for all three vectors. _Notice that the vector names are capital letters._

```{r ex="ex06", type="pre-exercise-code"}

# No pre-exercise code for this exercise

```

```{r ex="ex06", type="sample-code"}

# Create a calculated crosstab for N, P, and K in the npk data frame.


```

```{r ex="ex06", type="solution"}

aggregate(yield~N+P+K, data = npk, FUN = mean)

```

```{r ex="ex06", type="sct"}

ex61neq <- "Yield should be followed by a tilde then the three grouping variables."
ex62neq <- "Be sure npk is specified as the data."
ex63neq <- "Be sure mean is specified as the function."

state6 <- ex() %>% check_function("aggregate")
state6 %>% 
  check_arg("formula") %>% 
  check_equal(incorrect_msg = ex61neq)

state6 %>% 
  check_arg("data") %>% 
  check_equal(incorrect_msg = ex62neq)

state6 %>% 
  check_arg("FUN") %>% 
  check_equal(incorrect_msg = ex63neq)

success_msg("Perfect! Calculating the mean or other value makes crosstabs more useful!")

```

-----

## Rounding

In order to facilite understanding, _R_ makes it easy for researchers to round the results of calculations to whatever level is desired. It is important to note that even if the displayed value is rounded, _R_ still uses the full decimal number for calculations. The _R_ command to round a number is `round()` where the number to be rounded is listed first in the parenthesis and the number of decimal places is listed second. So `round(1.3498, 2)` would be rounded to 1.35 and `round(1.3498, 1)` would be rounded to 1.3. The number to be rounded can be a calculated value rather than just a plain number.

### Demonstrate: Rounding

As an example, here is the same `aggregate` command used in the previous example, but with the results rounded. Notice how the `aggregate` command is the same, but it is wrapped in a `round` function to round off the calculations. In the first example the result is rounded to three decimal places and in the second example to two decimal places.

<span style="background-color: #ffff99; font-style: italic;">This demonstration contains two different examples of rounding.</span>

<span style="background-color:#ffff99;font-style:italic;">Note: this demonstration contains two examples of rounding.</span>

```{r}

# Mean of displacement by cylinders
round(aggregate(disp~cyl, data = mtcars, FUN = mean), digits = 3)

# Mean of displacement by cyl and gears
round(aggregate(disp~cyl+gear, data = mtcars, FUN = mean), digits = 2)

```

### Skill Check: Rounding

Using the [_infert_](/tutorials/9999-data-dict/index.html#infert) data frame, create a calculated crosstab for _case_, _induced_, and _spontaneous_. Aggregate the mean _age_ for all three vectors. Round the results to two decimal places.

```{r ex="ex07", type="pre-exercise-code"}

# No pre-exercise code for this exercise

```

```{r ex="ex07", type="sample-code"}

# Create a calculated crosstab of age rounded to two decimal places for case, induced, and spontaneous in the infert data frame.


```

```{r ex="ex07", type="solution"}

round(aggregate(age~case+induced+spontaneous, data=infert, FUN=mean), digits = 2)

```

```{r ex="ex07", type="sct"}

ex71neq <- "In aggregate, age should be followed by a tilde then the three grouping variables."
ex72neq <- "In aggregate, be sure infert is specified as the data."
ex73neq <- "In aggregate, be sure mean is specified as the FUN."
ex74neq <- "Check to be sure you have rounded to the correct number of digits."

state71 <- ex() %>% check_function("aggregate")
state71 %>% 
  check_arg("formula") %>% 
  check_equal(incorrect_msg = ex71neq)

state71 %>% 
  check_arg("data") %>% 
  check_equal(incorrect_msg = ex72neq)

state71 %>% 
  check_arg("FUN") %>% 
  check_equal(incorrect_msg = ex73neq)

state72 <- ex() %>% check_function("round")
state72 %>% 
  check_result() %>%
  check_equal(incorrect_msg = ex74neq)




# fun71state <- ex() %>% check_function("aggregate")
# fun71state %>% check_arg("formula") %>% check_equal()
# fun71state %>% check_arg("data") %>% check_equal()
# fun71state %>% check_arg("FUN") %>% check_equal()
# 
# fun72state <- ex() %>% check_function("round")
# fun72state %>% check_arg("x") %>% check_equal()
# fun72state %>% check_arg("digits") %>% check_equal()

success_msg("Good Work! A rounded mean is much easier to use!")

```

-----

## Next

The last tutorial created visualizations for various [descriptive measures](/tutorials/0040-boxplot) and the next one creates visualizations for [frequency measures](/tutorials/0060-viz-freq).
